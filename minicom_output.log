 

Phytium-Pi#
Phytium-Pi#
Phytium-Pi#
Phytium-Pi#go 0x90100000
## Starting application at 0x90100000 ...
aaaaaaaaaaaacarch = aarch64
platform = aarch64-phytium-pi
target = aarch64-unknown-none-softfloat
smp = 1
build_mode = release
log_level = debug

ccc[ 40.585743 0 axruntime:138] Logging is enabled.
[ 40.591472 0 axruntime:139] Primary CPU 512 started, dtb = 0x1.
[ 40.598589 0 axruntime:141] Found physcial memory regions:
c[ 40.605360 0 axruntime:144]   [PA:0x90100000, PA:0x90120000) .text (READ | EXECUTE | RESERVED)
[ 40.615168 0 axruntime:144]   [PA:0x90120000, PA:0x90128000) .rodata (READ | RESERVED)
[ 40.624282 0 axruntime:144]   [PA:0x90128000, PA:0x9012c000) .data .tdata .tbss .percpu (READ | WRITE | RESERVED)
[ 40.635739 0 axruntime:144]   [PA:0x9012c000, PA:0x9016c000) boot stack (READ | WRITE | RESERVED)
[ 40.645808 0 axruntime:144]   [PA:0x9016c000, PA:0x90191000) .bss (READ | WRITE | RESERVED)
[ 40.655356 0 axruntime:144]   [PA:0x0, PA:0x1000) spintable (READ | WRITE | RESERVED)
[ 40.664383 0 axruntime:144]   [PA:0x90191000, PA:0x90491000) nocache memory (READ | WRITE | DEVICE)
[ 40.674626 0 axruntime:144]   [PA:0x90491000, PA:0xffd00000) free memory (READ | WRITE | FREE)
[ 40.684434 0 axruntime:144]   [PA:0x2800c000, PA:0x2800d000) mmio (READ | WRITE | DEVICE | RESERVED)
[ 40.694763 0 axruntime:144]   [PA:0x2800d000, PA:0x2800e000) mmio (READ | WRITE | DEVICE | RESERVED)
[ 40.705092 0 axruntime:144]   [PA:0x2800e000, PA:0x2800f000) mmio (READ | WRITE | DEVICE | RESERVED)
[ 40.715422 0 axruntime:144]   [PA:0x2800f000, PA:0x28010000) mmio (READ | WRITE | DEVICE | RESERVED)
[ 40.725751 0 axruntime:144]   [PA:0x30000000, PA:0x38000000) mmio (READ | WRITE | DEVICE | RESERVED)
[ 40.736080 0 axruntime:144]   [PA:0x40000000, PA:0x50000000) mmio (READ | WRITE | DEVICE | RESERVED)
[ 40.746410 0 axruntime:223] Initialize global memory allocator...
[ 40.753701 0 axruntime:224]   use TLSF allocator.
[ 40.759605 0 axalloc:281] initialize global allocator at: free-[0xffff000090491000, 0xffff0000ffd00000)
[ 40.770517 0 axruntime:158] Initialize kernel page table...
[ 40.777062 0 axruntime:258] Initialize global no cache memory allocator...
[ 40.785037 0 axalloc:297] initialize global allocator at: nocache-[0x90191000,0x90491000)
[ 40.794412 0 axruntime:165] Initialize platform devices...
[ 40.801093 0 axtask::api:66] Initialize scheduling...
[ 40.807348 0 axtask::task:146] new task: Task(1, "idle")
[ 40.813857 0 axtask::task:146] new task: Task(3, "gc")
[ 40.820194 0 axalloc:126] expand heap memory: [0xffff0000904a4000, 0xffff0000904e4000)
[ 40.829310 0 axalloc:126] expand heap memory: [0xffff0000904e4000, 0xffff000090564000)
[ 40.838419 0 axtask::api:72]   use FIFO scheduler.
[ 40.844407 0 axdriver:158] Initialize device drivers...
[ 40.850830 0 axdriver:159]   device model: static
[ 40.856732 0 driver_pci::phytium:18] PCIe link start @0xFFFF000040000000...
[ 40.864891 0 driver_pci::phytium:19] theroticly, since uboot had already initialized it, we need't to operate it any more!
[ 40.877130 0 axdriver::bus::pci:14] probing in pci.rs!
[ 40.883467 0 driver_pci::root_complex:96] into next!
[ 40.889630 0 driver_pci::root_complex:98] looped
[ 40.895445 0 driver_pci::root_complex:98] looped
[ 40.901261 0 driver_pci::root_complex:98] looped
[ 40.907077 0 driver_pci::root_complex:98] looped
[ 40.912892 0 driver_pci::root_complex:98] looped
[ 40.918708 0 driver_pci::root_complex:98] looped
[ 40.924523 0 driver_pci::root_complex:98] looped
[ 40.930339 0 driver_pci::root_complex:98] looped
[ 40.936155 0 driver_pci::root_complex:98] looped
[ 40.941970 0 driver_pci::root_complex:98] looped
[ 40.947786 0 driver_pci::root_complex:98] looped
[ 40.953601 0 driver_pci::root_complex:98] looped
[ 40.959417 0 driver_pci::root_complex:98] looped
[ 40.965232 0 driver_pci::root_complex:98] looped
[ 40.971048 0 driver_pci::root_complex:98] looped
[ 40.976864 0 driver_pci::root_complex:98] looped
[ 40.982679 0 driver_pci::root_complex:98] looped
[ 40.988495 0 driver_pci::root_complex:98] looped
[ 40.994311 0 driver_pci::root_complex:98] looped
[ 41.000126 0 driver_pci::root_complex:98] looped
[ 41.005942 0 driver_pci::root_complex:98] looped
[ 41.011757 0 driver_pci::root_complex:98] looped
[ 41.017573 0 driver_pci::root_complex:98] looped
[ 41.023389 0 driver_pci::root_complex:98] looped
[ 41.029204 0 driver_pci::root_complex:98] looped
[ 41.035020 0 driver_pci::root_complex:98] looped
[ 41.040835 0 driver_pci::root_complex:98] looped
[ 41.046651 0 driver_pci::root_complex:98] looped
[ 41.052467 0 driver_pci::root_complex:98] looped
[ 41.058282 0 driver_pci::root_complex:98] looped
[ 41.064098 0 driver_pci::root_complex:98] looped
[ 41.069913 0 driver_pci::root_complex:98] looped
[ 41.075729 0 driver_pci::root_complex:98] looped
[ 41.081545 0 driver_pci::root_complex:116] none!
[ 41.087360 0 axdriver:190] number of usb host controller: 0
[ 41.094130 0 axruntime:201] Primary CPU 512 init OK.
Available commands:
  exit
  help
  uname
  ldr
  str
  test_xhci
arceos# test_xhci
[ 43.572831 0:2 driver_usb::host::xhci:49] resetting xhci controller
[ 43.577592 0:2 driver_usb::host::xhci:50] before reset:UsbStatusRegister { hc_halted: false, host_system_error: false, event_interrupt: false, port_change_detect: true, save_state_status: false, restore_state_status: false, save_restore_error: false, controller_not_ready: false, host_controller_error: false }
[ 43.606149 0:2 driver_usb::host::xhci:144] stop
[ 43.611878 0:2 driver_usb::host::xhci:149] wait until halt
[ 43.618562 0:2 driver_usb::host::xhci:151] halted
[ 43.624464 0:2 driver_usb::host::xhci:153] HCRST!
[ 43.630368 0:2 driver_usb::host::xhci:179] Reset xHCI Controller Globally
[ 43.638356 0:2 driver_usb::host::structures::xhci_slot_manager:78] max slot: 0
[ 43.646772 0:2 driver_usb::host::structures::xhci_slot_manager:90] initialized!
[ 43.655278 0:2 driver_usb::host::structures::xhci_event_manager:43] initilizating!
[ 43.664079 0:2 driver_usb::host::structures::event_ring:33] created!
[ 43.671597 0:2 driver_usb::host::structures::xhci_event_manager:56] test
[ 43.679500 0:2 driver_usb::host::structures::xhci_event_manager:101] initialized!
[ 43.688211 0:2 driver_usb::host::structures::xhci_command_manager:218] initialized!
[ 43.697036 0:2 driver_usb::host::structures::scratchpad:54] initialized!
[ 43.704928 0:2 driver_usb::host::structures::scratchpad:60] initialized!
[ 43.712828 0:2 driver_usb::host::structures::xhci_roothub:278] number of ports:2
[ 43.721419 0:2 driver_usb::host::structures::xhci_roothub:283] allocating port 0
[ 43.730013 0:2 driver_usb::host::structures::xhci_roothub:296] assert:0 == 0
[ 43.738259 0:2 driver_usb::host::structures::xhci_roothub:283] allocating port 1
[ 43.746852 0:2 driver_usb::host::structures::xhci_roothub:296] assert:1 == 1
[ 43.755098 0:2 driver_usb::host::structures::xhci_roothub:310] initialized!
[ 43.763258 0:2 driver_usb::host::xhci:66] before start:UsbStatusRegister { hc_halted: true, host_system_error: false, event_interrupt: false, port_change_detect: true, save_state_status: false, restore_state_status: false, save_restore_error: false, controller_not_ready: false, host_controller_error: false }
[ 43.791728 0:2 driver_usb::host::xhci:77] init completed!, coltroller state:UsbStatusRegister { hc_halted: false, host_system_error: false, event_interrupt: false, port_change_detect: true, save_state_status: false, restore_state_status: false, save_restore_error: false, controller_not_ready: false, host_controller_error: false }
[ 43.822110 0:2 driver_usb::host::xhci:86] port0 : false
[ 43.828532 0:2 driver_usb::host::xhci:86] port1 : true
[ 43.834867 0:2 driver_usb::host::xhci:113] initializing roothub
[ 43.841985 0:2 driver_usb::host::structures::xhci_roothub:207] initializing root ports
[ 43.851099 0:2 driver_usb::host::structures::xhci_roothub:212] initializing port 0
[ 43.859868 0:2 driver_usb::host::structures::xhci_roothub:39] port 0 not connected
[ 43.868632 0:2 driver_usb::host::structures::xhci_roothub:212] initializing port 1
[ 43.877401 0:2 driver_usb::host::structures::xhci_roothub:42] port 1 connected, continue
[ 43.886688 0:2 driver_usb::host::structures::xhci_roothub:99] port status PortStatusAndControlRegister { current_connect_status: true, port_enabled_disabled: true, over_current_active: false, port_reset: false, port_link_state: 0, port_power: true, port_speed: 4, port_indicator_control: Off, port_link_state_write_strobe: false, connect_status_change: false, port_enabled_disabled_change: false, warm_port_reset_change: false, over_current_change: false, port_reset_change: true, port_link_state_change: false, port_config_error_change: false, cold_attach_status: false, wake_on_connect_enable: false, wake_on_disconnect_enable: false, wake_on_over_current_enable: false, device_removable: false, warm_port_reset: false }
[ 43.951007 0:2 driver_usb::host::structures::xhci_roothub:112] port speed: USBSpeedSuper
[ 43.960293 0:2 driver_usb::host::structures::xhci_roothub:114] initializing device: USBSpeedSuper
[ 43.970362 0:2 driver_usb::host::structures::xhci_usb_device:38] new device! port:1
[ 43.979216 0:2 driver_usb::host::structures::xhci_command_manager:107] do command EnableSlot(EnableSlot { slot_type: 0, cycle_bit: false }) !
[ 43.993105 0:2 driver_usb::host::structures::xhci_command_manager:122] waiting for interrupt handler complete!
[ 44.004304 0:2 driver_usb::host::structures::xhci_event_manager:111] event handler has a trb:PortStatusChange(PortStatusChange { completion_code: Ok(Success), port_id: 2, cycle_bit: true })
[ 44.022355 0:2 driver_usb::host::structures::xhci_event_manager:141] step into port status change.

[ 44.032685 0:2 driver_usb::host::structures::xhci_roothub:153] port 1 status changed
[ 44.041626 0:2 driver_usb::host::structures::xhci_event_manager:111] event handler has a trb:CommandCompletion(CommandCompletion { completion_code: Ok(Success), command_trb_pointer: 2417582080, command_completion_parameter: 0, vf_id: 0, slot_id: 1, cycle_bit: true })
[ 44.066449 0:2 driver_usb::host::structures::xhci_event_manager:136] step into command completion.

[ 44.076779 0:2 driver_usb::host::structures::xhci_command_manager:176] handleing command complete:CommandCompletion { completion_code: Ok(Success), command_trb_pointer: 2417582080, command_completion_parameter: 0, vf_id: 0, slot_id: 1, cycle_bit: true }
[ 44.100389 0:2 driver_usb::host::structures::xhci_command_manager:128] t o t a l success!
[ 44.109763 0:2 driver_usb::host::structures::xhci_usb_device:42] enable slot success!
[ 44.118849 0:2 driver_usb::host::structures::xhci_roothub:117] writing ...
[ 44.126862 0:2 driver_usb::host::structures::xhci_usb_device:111] init input ctx
[ 44.137528 0:2 driver_usb::host::structures::xhci_usb_device:143] begin config endpoint 0 and assign dev!
[ 44.146220 0:2 driver_usb::host::structures::xhci_usb_device:147] config ep0
[ 44.156484 0:2 driver_usb::host::structures::xhci_usb_device:164] assigning device into dcbaa
[ 44.164186 0:2 driver_usb::host::structures::xhci_slot_manager:21] assign device: VA:0x9019c000 to dcbaa 1
[ 44.177037 0:2 driver_usb::host::structures::xhci_usb_device:175] addressing device
[ 44.183890 0:2 driver_usb::host::structures::xhci_command_manager:82] addressing device!
[ 44.193177 0:2 driver_usb::host::structures::xhci_command_manager:107] do command AddressDevice(AddressDevice { input_context_pointer: 2417610752, block_set_address_request: false, slot_id: 1, cycle_bit: false }) !
[ 44.213403 0:2 driver_usb::host::structures::xhci_command_manager:122] waiting for interrupt handler complete!
[ 44.224600 0:2 driver_usb::host::structures::xhci_event_manager:111] event handler has a trb:CommandCompletion(CommandCompletion { completion_code: Ok(Success), command_trb_pointer: 2417582096, command_completion_parameter: 0, vf_id: 0, slot_id: 1, cycle_bit: true })
[ 44.249424 0:2 driver_usb::host::structures::xhci_event_manager:136] step into command completion.

[ 44.259753 0:2 driver_usb::host::structures::xhci_command_manager:176] handleing command complete:CommandCompletion { completion_code: Ok(Success), command_trb_pointer: 2417582096, command_completion_parameter: 0, vf_id: 0, slot_id: 1, cycle_bit: true }
[ 44.283362 0:2 driver_usb::host::structures::xhci_command_manager:128] t o t a l success!
[ 44.292737 0:2 driver_usb::host::structures::xhci_usb_device:185] addressed device at slot id 1
[ 44.302632 0:2 driver_usb::host::structures::xhci_usb_device:186] command result CommandCompletion { completion_code: Ok(Success), command_trb_pointer: 2417582096, command_completion_parameter: 0, vf_id: 0, slot_id: 1, cycle_bit: true }
[ 44.326766 0:2 driver_usb::host::structures::xhci_usb_device:312] get descriptor!
[ 44.333448 0:2 driver_usb::host::structures::xhci_usb_device:330] endpoint id: 1
[ 44.342039 0:2 driver_usb::host::structures::xhci_usb_device:341] setup stage!
[ 44.350460 0:2 driver_usb::host::structures::xhci_usb_device:292] doorbell ing
[ 44.358890 0:2 driver_usb::host::structures::xhci_event_manager:111] event handler has a trb:TransferEvent(TransferEvent { completion_code: Ok(EndpointNotEnabledError), trb_pointer: 0, trb_transfer_length: 0, event_data: false, endpoint_id: 1, slot_id: 1, cycle_bit: true })
[ 44.384311 0:2 driver_usb::host::structures::xhci_event_manager:114] event = TransferEvent { completion_code: Ok(EndpointNotEnabledError), trb_pointer: 0, trb_transfer_length: 0, event_data: false, endpoint_id: 1, slot_id: 1, cycle_bit: true }
[ 44.407052 0:2 driver_usb::host::structures::xhci_event_manager:115] step into transfer event

[ 44.416948 0:2 driver_usb::host::structures::xhci_slot_manager:47] transfer event! param: EndpointNotEnabledError,TransferEvent { completion_code: Ok(EndpointNotEnabledError), trb_pointer: 0, trb_transfer_length: 0, event_data: false, endpoint_id: 1, slot_id: 1, cycle_bit: true }
[ 44.442901 0:2 driver_usb::host::structures::xhci_slot_manager:54] failed, code:EndpointNotEnabledError
